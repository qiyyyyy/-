
# 改进版VNPY高频大象策略提示词（双资金池版本）

```
请基于VNPY框架开发一个适用于中国A股T+1市场的高频大象策略。我计划使用一半现金一半股票的资金配置，需要同时管理两个资金池进行协同操作。请设计完整、模块化的策略代码，适合个人投资者使用。

## 策略基本设置

1. **双资金池管理**
   - 股票资金池：已持有的多只股票，用于日内"先卖后买"高频交易
   - 现金资金池：用于支持买回操作和建立新仓位（适应T+1规则）

2. **整体目标**
   - 利用大单支撑（大象）进行高频交易获利
   - 保持策略可持续性，平衡两个资金池
   - 控制风险，避免大幅亏损

## 详细功能模块需求

### 1. 资金管理模块
   - 初始化股票池和现金池配置
   - 动态调整两个资金池的比例
   - 计算单个股票可交易数量
   - 现金分配算法（买回保障金vs新建仓资金）
   - 记录和更新资金池状态

### 2. 大象识别模块
   - 分析盘口深度数据识别大额买单支撑
   - 大象判定标准：非买一价且委托量超过阈值的买单
   - 大象质量评估（稳定性、持续时间）
   - 大象变化监控（撤单、减量预警）

### 3. 交易信号生成模块
   - **股票池信号**：发现大象后生成卖出信号
   - **现金池信号**：
     * 补充买回信号（配合股票池的卖出）
     * 新建仓信号（识别优质机会建立次日可用仓位）
   - 信号优先级管理，解决资源竞争

### 4. 交易执行模块
   - 卖出策略：高于大象价格小幅卖出
   - 买回策略：回调至接近大象价格时买回
   - 止损机制：大象消失或超时的应急处理
   - 订单跟踪与撤单管理
   - 新建仓逻辑（考虑次日可用于高频）

### 5. 风险控制模块
   - 单笔交易风险控制
   - 单只股票日内交易次数限制
   - 资金池暴露度控制
   - 日内累计亏损限制
   - 市场异常波动应对机制

### 6. 数据统计与报告模块
   - 交易记录详细日志
   - 分资金池收益统计
   - 每日绩效报告生成
   - 策略表现分析与优化建议

## 关键参数设置

1. **大象识别参数**
   - `elephant_amount`: 判定为大象的最小委托量
   - `elephant_space`: 大象与卖一价的最大价差
   - `elephant_verify_count`: 确认大象存在的检测次数

2. **交易执行参数**
   - `price_tick`: 最小价格变动单位
   - `sell_price_offset`: 卖出价格高于大象的偏移量
   - `buy_price_offset`: 买回价格高于大象的偏移量
   - `max_wait_seconds`: 最长等待成交时间

3. **资金管理参数**
   - `stock_pool_ratio`: 股票资金池目标比例（默认0.5）
   - `cash_reserve_ratio`: 现金池中作为买回保障的比例
   - `max_single_position`: 单只股票最大持仓比例

4. **风控参数**
   - `max_daily_loss`: 日最大亏损限制
   - `max_single_loss`: 单笔最大亏损限制
   - `max_daily_trades`: 单只股票日内最大交易次数

## 代码结构要求

1. 继承自`CtaTemplate`的主策略类
2. 清晰的类方法结构，严格分离各功能模块
3. 完善的日志记录，记录每个关键决策点
4. 参数配置支持外部文件导入
5. 适当的性能优化，减少不必要的计算
6. 完整的异常处理，确保策略稳定运行
7. 中文注释，便于理解和修改

## 示例交易流程

请详细说明以下典型场景的代码处理流程：
1. 发现大象时如何从股票池卖出并安排买回
2. 如何利用现金池建立新仓位（选股逻辑可简化）
3. 大象消失时的风险控制处理
4. 两个资金池之间的平衡调整机制

请根据以上需求，使用VNPY框架开发一个完整的双资金池高频大象策略。代码需要模块化，便于维护和扩展，适合个人投资者在中国A股T+1市场使用。
```


# vnpy行情获取能力及高频交易适用性分析

## 行情数据深度

1. **国内A股市场**
   - 通常支持5档或10档行情数据
   - 使用CTP、XTP等接口时深度有限
   - 部分券商Level-2接口可获取到完整10档行情
   - 实时性：3秒左右推送一次(股票市场规定)

2. **期货市场**
   - 支持5档行情
   - 推送频率比股票市场更快

3. **其他市场**
   - 加密货币可获取更深档位(最多可达几十甚至上千档)
   - 外盘期货、外汇等深度取决于具体连接的数据源

## 高频交易适用性

1. **技术层面限制**
   - Python GIL锁会影响多线程性能
   - 行情推送和订单处理存在一定延迟
   - 毫秒级响应在普通硬件配置下有挑战

2. **实际表现**
   - 适合秒级至分钟级别的中高频策略
   - 不适合微秒级极高频交易
   - 大象策略属于盘口策略，对行情深度要求不是特别高

3. **优化方向**
   - 可通过C++引擎优化性能
   - 使用本地化部署减少网络延迟
   - 精简策略逻辑提高响应速度

## 针对大象策略的建议

对于大象策略这类以盘口为基础的策略：
1. 重点关注前3-5档深度数据，这对识别"大象"已经足够
2. 设计策略时预留更多处理时间，不要过于激进
3. 可以考虑在vnpy基础上开发简化版策略，专注于处理速度
4. 策略侧重于大象识别的准确性，而非极速反应

总体而言，vnpy对于个人使用的中高频大象策略是基本够用的，但需要合理设置参数和预期，不要期望达到专业高频交易机构的性能水平。对于A股T+1市场的特点，可以适当降低策略频率，更注重选择优质的大象识别机会。
