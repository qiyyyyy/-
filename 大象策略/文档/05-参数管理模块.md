# 参数管理模块

## 模块作用

参数管理模块是大象策略的配置中心，负责管理和提供策略运行所需的各类参数。该模块支持全局通用参数和股票特定参数，允许为不同股票设置不同的交易参数，大大提高了策略的灵活性和适应性。

## 基本功能

参数管理模块提供以下核心功能：

1. **参数存储**：持久化保存全局和股票特定参数
2. **参数查询**：提供统一的参数访问接口
3. **参数更新**：允许动态更新参数
4. **参数优先级**：遵循"股票特定参数优先于全局参数"的原则
5. **配置文件管理**：自动创建和维护配置文件

## 参数文件结构

参数管理模块管理三个主要配置文件：

1. **global_params.json**：全局参数配置
2. **symbol_params.json**：股票特定参数配置
3. **stocks.json**：交易股票列表

### 全局参数文件示例 (global_params.json)

```json
{
  "大象识别": {
    "大象委托量阈值": 1000000.0,
    "大象价差阈值": 3,
    "确认次数": 3,
    "大象稳定时间": 5
  },
  "交易执行": {
    "价格偏移量": 0.01,
    "卖出偏移量倍数": 2.0,
    "买入偏移量倍数": 1.0
  },
  "风险控制": {
    "单笔最大亏损比例": 0.01,
    "日内最大亏损比例": 0.05
  }
}
```

### 股票特定参数文件示例 (symbol_params.json)

```json
{
  "000001": {
    "大象识别": {
      "大象委托量阈值": 1500000.0,
      "大象价差阈值": 4
    },
    "交易执行": {
      "价格偏移量": 0.02
    }
  },
  "600000": {
    "大象识别": {
      "大象委托量阈值": 1200000.0
    }
  }
}
```

### 股票列表文件示例 (stocks.json)

```json
{
  "交易股票": ["000001", "600000", "601318"],
  "分组": {
    "金融股": ["000001", "600000"],
    "大盘股": ["601318"]
  }
}
```

## 主要API说明

参数管理模块提供以下主要API：

```python
# 获取参数（优先取品种特定参数，若不存在则取全局参数）
参数值 = 参数管理器.获取参数(品种代码="000001", 模块="大象识别", 参数名="大象委托量阈值", 默认值=1000000.0)

# 设置全局参数
参数管理器.设置全局参数(模块="大象识别", 参数名="大象委托量阈值", 参数值=1200000.0)

# 设置品种特定参数
参数管理器.设置品种参数(品种代码="000001", 模块="大象识别", 参数名="大象委托量阈值", 参数值=1500000.0)

# 获取品种所有参数（全局参数和品种特定参数的合并）
所有参数 = 参数管理器.获取品种所有参数(品种代码="000001")
```

## 使用指南

### 初始化参数管理器

```python
from 大象策略.modules.参数管理 import 参数管理器

# 初始化参数管理器
参数管理 = 参数管理器(配置目录="config")
```

### 读取参数示例

```python
# 读取大象识别模块的参数
大象委托量阈值 = 参数管理.获取参数("000001", "大象识别", "大象委托量阈值", 1000000.0)
大象价差阈值 = 参数管理.获取参数("000001", "大象识别", "大象价差阈值", 3)

# 读取交易执行模块的参数
价格偏移量 = 参数管理.获取参数("000001", "交易执行", "价格偏移量", 0.01)
```

### 更新参数示例

```python
# 更新全局参数
参数管理.设置全局参数("大象识别", "大象委托量阈值", 1200000.0)

# 更新特定股票的参数
参数管理.设置品种参数("000001", "大象识别", "大象委托量阈值", 1500000.0)
```

### 参数优先级

当请求某个参数时，参数管理器会按以下优先级查找：

1. 首先检查是否有股票特定参数
2. 如果没有，则查找全局参数
3. 如果全局参数也不存在，则返回提供的默认值

```python
# 对于000001，有特定的大象委托量阈值设置为1500000.0
参数值 = 参数管理.获取参数("000001", "大象识别", "大象委托量阈值", 1000000.0)
# 返回1500000.0

# 对于000002，没有特定设置，使用全局参数1200000.0
参数值 = 参数管理.获取参数("000002", "大象识别", "大象委托量阈值", 1000000.0)
# 返回1200000.0

# 对于一个不存在的参数，返回默认值
参数值 = 参数管理.获取参数("000001", "大象识别", "不存在的参数", "默认值")
# 返回"默认值"
```

## 配置文件管理

### 配置文件自动创建

参数管理器在初始化时会自动检查配置文件是否存在，如果不存在会创建空的配置文件：

```python
# 创建参数管理器时指定配置目录
参数管理 = 参数管理器(配置目录="custom_config")
# 如果custom_config目录不存在，会自动创建
# 如果配置文件不存在，会创建空的配置文件
```

### 配置文件备份

每次保存配置前，可以自动创建备份：

```python
# 设置参数管理器开启自动备份
参数管理.启用自动备份 = True
参数管理.备份目录 = "config/backups"

# 此时每次调用设置参数方法会自动备份原配置
参数管理.设置全局参数("大象识别", "大象委托量阈值", 1200000.0)
# 原配置会被备份到config/backups目录
```

## 高级使用

### 批量设置参数

```python
# 批量设置多个参数
大象识别参数 = {
    "大象委托量阈值": 1200000.0,
    "大象价差阈值": 4,
    "确认次数": 3
}

for 参数名, 参数值 in 大象识别参数.items():
    参数管理.设置全局参数("大象识别", 参数名, 参数值)
```

### 参数分组管理

使用股票列表文件中的分组功能，可以实现对股票分组进行批量参数设置：

```python
# 读取股票分组
stocks_file = os.path.join(参数管理.配置目录, "stocks.json")
with open(stocks_file, "r", encoding="utf-8") as f:
    股票配置 = json.load(f)

# 获取金融股分组
金融股 = 股票配置.get("分组", {}).get("金融股", [])

# 为所有金融股设置相同的参数
for 股票代码 in 金融股:
    参数管理.设置品种参数(股票代码, "大象识别", "大象委托量阈值", 1500000.0)
```

## 与网页管理的集成

参数管理模块与网页管理模块紧密集成，允许通过Web界面修改参数：

1. 在网页界面的"设置"选项卡可以修改全局参数
2. 在"品种参数"选项卡可以修改特定股票的参数
3. 修改后的参数会实时保存到配置文件
4. 策略会自动使用更新后的参数，无需重启

## 常见问题

### 问题1：修改参数后没有生效

可能原因及解决方案：
- **配置文件权限问题**：检查配置文件的写入权限
- **配置目录路径错误**：确认配置目录路径正确
- **JSON格式错误**：检查配置文件的JSON格式是否有误

### 问题2：参数值类型异常

可能原因及解决方案：
- **类型转换错误**：参数值类型应与预期一致（数字、布尔值、字符串等）
- **默认值设置错误**：确保提供了正确类型的默认值

### 问题3：参数文件损坏

可能原因及解决方案：
- **异常关闭导致文件损坏**：启用自动备份功能，从备份恢复
- **手动编辑错误**：避免直接编辑配置文件，使用API或网页界面

## 性能考虑

参数管理模块通常不是性能瓶颈，但有几点值得注意：

1. **缓存机制**：频繁读取的参数会被缓存，避免重复IO操作
2. **批量读写**：尽量批量读取和设置参数，减少文件操作
3. **文件大小控制**：避免配置文件过大，可能影响加载速度

## 总结

参数管理模块是大象策略实现灵活配置的关键组件，通过区分全局参数和股票特定参数，可以针对不同特性的股票采用不同的策略参数，提高策略的适应性和性能。建议新用户：

1. 先熟悉全局参数配置，了解各个模块的参数含义
2. 根据不同股票的特性，逐步配置股票特定参数
3. 利用网页管理界面进行参数调整和优化
4. 定期备份配置文件，避免意外丢失

灵活的参数配置是策略成功的关键因素之一，合理利用参数管理模块可以让策略更好地适应不同市场环境和股票特性。 